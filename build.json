{
  "vars": {
    "ROOT": "./",
    "CORE": "src/core",
    "SRC": "src",
    "INCL": "include",
    "BUILD": "build",
    "BIN": "bin",
    "LOGS": "logs",
    "LIB": "lib",
    "CJSON": "lib/cjson"
  },
  "name": "Sigma.Build",
  "log": "{LOGS}/sigma_build.log",
  "targets": [
    {
      "name": "libsigtest",
      "type": "lib",
      "dir": "{ROOT}/sigma-test/",
      "sources": [
        "{SRC}/sigtest.c"
      ],
      "build_dir": "{BUILD}/",
      "cc": "gcc",
      "c_flags": [
        "-Wall",
        "-g",
        "-fPIC",
        "-I{INCL}",
        "-DSIGTEST_TEST"
      ],
      "ld_flags": [
        "-shared"
      ],
      "out_dir": "{LIB}/",
      "output": "libstest.so"
    },
    {
      "name": "sigtest_cli",
      "type": "exe",
      "dir": "{ROOT}/sigma-test/",
      "sources": [
        "{SRC}/sigtest_cli.c"
      ],
      "build_dir": "{BUILD}",
      "cc": "gcc",
      "c_flags": [
        "-Wall",
        "-g",
        "-fPIC",
        "-I{INCL}"
      ],
      "ld_flags": [
        "-g",
        "-L{LIB}",
        "-lsigtest",
        "-Wl,-rpath,{LIB}"
      ],
      "dependencies": [
        "libsigtest"
      ],
      "out_dir": "{BIN}"
    },
    {
      "name": "sbuild_exe",
      "type": "exe",
      "sources": [
        "{CORE}/cli_parser.c",
        "{CORE}/var_table.c",
        "{CORE}/loader.c",
        "{CORE}/builder.c",
        "{SRC}/sbuild.c",
        "{SRC}/main.c",
        "{CJSON}/cJSON.c"
      ],
      "build_dir": "{BUILD}/",
      "cc": "gcc",
      "c_flags": [
        "-Wall",
        "-O2",
        "-c",
        "-Iinclude",
        "-Ilib/cjson"
      ],
      "ld_flags": [],
      "out_dir": "{BIN}/",
      "output": "sbuild"
    },
    {
      "name": "dbg_sbuild",
      "type": "exe",
      "sources": [
        "{CORE}/cli_parser.c",
        "{CORE}/var_table.c",
        "{CORE}/loader.c",
        "{CORE}/builder.c",
        "{SRC}/sbuild.c",
        "{SRC}/main.c",
        "{CJSON}/cJSON.c"
      ],
      "build_dir": "{BUILD}/",
      "cc": "gcc",
      "c_flags": [
        "-Wall",
        "-Og",
        "-g3",
        "-c",
        "-Iinclude",
        "-Ilib/cjson"
      ],
      "ld_flags": [],
      "out_dir": "{BIN}/",
      "output": "sbuild"
    },
    {
      "name": "sbuild_lib",
      "type": "exe",
      "sources": [
        "{CORE}/cli_parser.c",
        "{CORE}/var_table.c",
        "{CORE}/loader.c",
        "{CORE}/builder.c",
        "{SRC}/sbuild.c",
        "{CJSON}/cJSON.c"
      ],
      "build_dir": "{BUILD}/",
      "cc": "gcc",
      "c_flags": [
        "-Wall",
        "-O2",
        "-c",
        "-fPIC",
        "-I{INCL}",
        "-I{CJSON}"
      ],
      "ld_flags": [
        "-shared"
      ],
      "out_dir": "{LIB}/",
      "output": "libsbuild.so"
    },
    {
      "name": "clean",
      "type": "op",
      "commands": {
        "linux": [
          "rm {BUILD}/*"
        ],
        "windows": [
          "del {BUILD}\\*"
        ]
      }
    },
    {
      "name": "mem_check",
      "type": "op",
      "commands": {
        "linux": [
          "valgrind --leak-check=full --track-origins=yes --error-exitcode=1 --log-file={LOGS}/mem_check.log ./test/bin/sbuild --build build.json:build_sb --log=2 --dbug=0"
        ],
        "windows": [
          "wsl valgrind --leak-check=full --track-origins=yes --error-exitcode=1 --log-file={LOGS}/mem_check.log ./test/bin/sbuild.exe --build build.json:build_sb --log=2 --dbug=0"
        ]
      }
    }
  ]
}